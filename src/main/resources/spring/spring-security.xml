<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/security"
             xmlns:beans="http://www.springframework.org/schema/beans"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:context="http://www.springframework.org/schema/context"
             xsi:schemaLocation="http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/security
http://www.springframework.org/schema/security/spring-security-4.2.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">
    <context:component-scan base-package="com.wlt.*" />
    <!-- 开发环境可以放置 <debug /> 配置，会输出详细Security处理日志，正式环境建议屏蔽 <debug /> 配置-->
    <debug />
    <!-- 该路径下的资源不用过滤 -->
    <http pattern="/include/js/**" security="none" />
    <http pattern="/include/css/**" security="none" />
    <http pattern="/include/scripts/**" security="none" />
    <http pattern="/include/jsp/**" security="none" />
    <http pattern="/images/**" security="none" />
    <http pattern="/login.jsp" security="none" />
    <!--设置那些资源可以访问，那些需要权限才能访问-->
    <!--auto-config = true 则使用from-login. 如果不使用该属性 则默认为http-basic(没有session).-->
    <!-- lowercase-comparisons：表示URL比较前先转为小写。-->
    <!-- path-type：表示使用Apache Ant的匹配模式。-->
    <!--access-denied-page：访问拒绝时转向的页面。-->
    <!-- access-decision-manager-ref：指定了自定义的访问策略管理器。-->
    <http auto-config="true" use-expressions="true">
        <intercept-url pattern="/api/login" access="permitAll" />
        <intercept-url pattern="/api/access_Denied" access="permitAll" />
        <intercept-url pattern="/api/password_Denied" access="permitAll" />
        <intercept-url pattern="/api/index" access="hasRole('ROLE_USER')" />
        <intercept-url pattern="/WEB-INF/**" access="hasRole('ROLE_USER')" />
        <!--把相应的目录的资源设置权限-->
        <intercept-url pattern="/WEB-INF/views/**" access="isAuthenticated()" />
        <intercept-url pattern="/**" access="isAuthenticated()" />
        <!--起始页，前提必须要permitall-->
        <!--login-page：指定登录页面。  -->
        <!--username-parameter：用户名对应的表单name-->
        <!--password-parameter:密码对应的表单name-->
        <!-- login-processing-url：指定了客户在登录页面中按下 Sign In 按钮时要访问的 URL。-->
        <!-- authentication-failure-url：指定了身份验证失败时跳转到的页面。-->
        <!-- default-target-url：指定了成功进行身份验证和授权后默认呈现给用户的页面。-->
        <!-- always-use-default-target：指定了是否在身份验证通过后总是跳转到default-target-url属性指定的URL。-->
        <form-login
                login-page="/api/login"
                username-parameter="username"
                password-parameter="password"
                login-processing-url="/api/index"
                authentication-failure-url="/api/password_Denied"
                authentication-success-forward-url="/api/index"/>
        <!--logout-url：指定了用于响应退出系统请求的URL。其默认值为：/j_spring_security_logout。-->
        <!-- logout-success-url：退出系统后转向的URL。-->
        <!-- invalidate-session：指定在退出系统时是否要销毁Session。-->
        <logout invalidate-session="true" logout-success-url="/api/login"
                logout-url="/api/j_spring_security_logout" />
        <!-- 实现免登陆验证 -->
        <remember-me />
        <!--是否允许多用户用一个账号登陆-->
        <!-- max-sessions:允许用户帐号登录的次数。范例限制用户只能登录一次。-->
        <!-- 此值表示：用户第二次登录时，前一次的登录信息都被清空。-->
        <!--   exception-if-maximum-exceeded:默认为false，-->
        <!-- 当exception-if-maximum-exceeded="true"时系统会拒绝第二次登录。-->
        <session-management >
            <concurrency-control max-sessions="1"
                                 error-if-maximum-exceeded="true" />
        </session-management>
        <!-- 将自定义的实现了权限控制逻辑的过滤器加入到spring-security的过滤器链中 -->
        <custom-filter ref="mySecurityFilter" before="FILTER_SECURITY_INTERCEPTOR"/>
        <csrf disabled="true"/>
    </http>
    <!--身份验证-->
    <!-- 将实现了用户信息获取的bean注入到authenticationManager中 -->
    <authentication-manager alias="MyAuthenticationManager">
        <authentication-provider user-service-ref="myUserDetailService">
            <!--如果用户的密码采用加密的话 <password-encoder hash="md5" /> -->
        </authentication-provider>
    </authentication-manager>
    <!--可以用注解开发-->
    <beans:bean id="mySecurityFilter" class="com.wlt.security.MySecurityFilter">
        <!--获取当前用户名的关联信息，并交给authenticationManager对比用户的密码-->
        <beans:property name="authenticationManager" ref="MyAuthenticationManager"/>
        <!--登入成功之后资源是否有权限访问鉴定-->
        <beans:property name="accessDecisionManager" ref="myAccessDecisionManager"/>
    </beans:bean>
    <!-- 自定义的获取用户信息的实现类 -->
    <beans:bean id="myUserDetailService" class="com.wlt.security.MyUserDetailService"/>
    <!-- 系统运行时加载 系统要拦截的资源   与用户请求时要过滤的资源 -->
    <beans:bean id="mySecurityMetadataSource" class="com.wlt.security.MySecurityMetadataSource"/>
      <!--<beans:bean id="myAuthenticationFilter" class="com.wlt.security.MyAuthenticationFilter"/>-->
    <!-- 验证用户请求资源  是否拥有权限 -->
    <!-- 这里myAccessDecisionManagerBean是用来注入到AbstractSecurityInterceptor中accessDecisionManager属性的，
       用来实现权限控制的具体逻辑 -->
    <beans:bean id="myAccessDecisionManager" class="com.wlt.security.MyAccessDecisionManager"/>
</beans:beans>